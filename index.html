<!DOCTYPE html>
<html>
<head>
	<title>Семантическая карта</title>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
	<style>
		.active {
			fill: #f06
		}
	</style>
</head>
<body>
	<div id="map"></div>
</body>
</html>

<script>
/*
	To-Do:
	* внедрить связи между предметами → сделать SVG-объекты связанными в DOM
	* хранить название или номер предмета в теге, чтобы можно было искать
	* перенести предметы из карты в json → добавить больше полей
	
	* сделать окна, которые появляются при наведении на предмет или связь
	* сделать так, чтобы дочерние предметы и связи с ними подсвечивались, когда кликаешь на предмет
	
	* внедрить теги и поиск по тегам
*/

	var width = 1000, height = 1000
	var draw = SVG().addTo('#map').size(width, height)
	draw.viewbox(0,0,width,height)
	
	cx = width / 2
	cy = height / 2
	d1 = 200
	const edge = d1 / 10
	
	var circle4 = draw.circle(d1*4).attr({'cx': cx, 'cy': cy, 'fill': '#ef949c'}).stroke({ color: '#000000', opacity: 1.0, width: 1 })
	var circle3 = draw.circle(d1*3).attr({'cx': cx, 'cy': cy, 'fill': '#fe9e49'}).stroke({ color: '#000000', opacity: 1.0, width: 1 })
	var circle2 = draw.circle(d1*2).attr({'cx': cx, 'cy': cy, 'fill': '#f5d642'}).stroke({ color: '#000000', opacity: 1.0, width: 1 })
	var circle1 = draw.circle(d1).attr({'cx': cx, 'cy': cy, 'fill': '#fefab8'}).stroke({ color: '#000000', opacity: 1.0, width: 1 })
	
	for (let i = 1; i < 5; i++) {
		draw.text(i + ' курс').font({ size: Math.floor(d1/15) }).move(cx-d1*0.075,cy-i*d1*0.5)
	}
	
	let DrawSubject = function(r, a, name, id) {
		var x = cx + r * (d1 / 2) * Math.cos(a)
		var y = cy + r * (d1 / 2) * Math.sin(a)
		
		var subject = draw.circle(edge).attr({
			'cx': x,
			'cy': y,
			'id': id
		})
		var text = draw.text(name).move(x-edge/2,y-edge/2)
		return subject.add(text)
	}
	
	let DrawLink = function(id1, id2) {
		return draw.line(
			parseInt(document.getElementById(id1).getAttribute('cx')),
			parseInt(document.getElementById(id1).getAttribute('cy')),
			parseInt(document.getElementById(id2).getAttribute('cx')),
			parseInt(document.getElementById(id2).getAttribute('cy')))
			.stroke('#000000')
	}
	
	fetch('./subjects.json')
    .then((response) => response.json())
    .then((json) => {
		console.log(json)
		json['Subjects'].forEach(function(subject) {
			var subj = DrawSubject(subject['r'], subject['a'], subject['name'], subject['id'])
			subj.click(function() {
				if (this.attr('class') == 'active') {
					this.attr('class', null)
				} else {
					this.attr('class', 'active')
				}
			})
			subj.mouseover(function(event) {
				console.log(event)
				draw.text(subject['name']).move(event['layerX'],event['layerY']).attr('id', subject['id'] + 'text')
			})
			subj.mouseout(function(event) {
				document.getElementById(subject['id'] + 'text').remove()
			})
		})
		json['Subjects'].forEach(function(subject) {
			subject['children'].forEach(function(childId) {
				DrawLink(subject['id'], childId)
			})
		})
	})
	//python -m http.server
	
</script>